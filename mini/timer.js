var dataTransfer,secondsInHour=3600,startTime=0,timeToCountInSeconds=0,countedSeconds=null,tickIntervalId=null,NUM_SIZE=2,lastTimer=0,PAUSE_LABEL="PAUSE",POP_TIME_DATA_ATTRIBUTE="data-time",POP_TIME_INDEX="data-time-index",POP_TIMES_SIZE=14,popTimes={},isPopTimeDrag=!1,ring=new Audio("ring.mp3");function parseUrl(t){for(var e=window.location.search.substr(1).split("-"),a=0,r=0;r<e.length;r++)-1!==e[r].lastIndexOf("hour")?a+=parseInt(e[r].substr(0,e[r].lastIndexOf("hour")))*secondsInHour:-1!==e[r].lastIndexOf("minute")?a+=60*parseInt(e[r].substr(0,e[r].lastIndexOf("minute"))):-1!==e[r].lastIndexOf("second")&&(a+=parseInt(e[r].substr(0,e[r].lastIndexOf("second"))));return a}ring.volume=.8,ring.addEventListener("timeupdate",function(){this.currentTime>this.duration-.5&&(ring.currentTime=0,ring.play())},!1);var getLocation=function(t){var e=document.createElement("a");return e.href=t,e};function onload(){setViewTime(parseUrl(window.location.href)),popTimesInit(),document.getElementsByClassName("restart")[0].addEventListener("mouseover",restartMouseOver),document.getElementsByClassName("restart")[0].addEventListener("mouseleave",restartMouseLeave);for(var t=document.getElementsByTagName("input"),e=0;e<t.length-1;e++){t.item(e).next=t.item(e+1)}0==localStorage.length&&(localStorage.setItem("0",'{"time": "5", "usage":0}'),localStorage.setItem("1",'{"time": "10", "usage":0}'),localStorage.setItem("2",'{"time": "15", "usage":0}'),localStorage.setItem("3",'{"time": "20", "usage":0}'),localStorage.setItem("4",'{"time": "30", "usage":0}'),localStorage.setItem("5",'{"time": "45", "usage":0}'),localStorage.setItem("6",'{"time": "60", "usage":0}'),localStorage.setItem("7",'{"time": "90", "usage":0}'),localStorage.setItem("8",'{"time": "120", "usage":0}'),localStorage.setItem("9",'{"time": "180", "usage":0}'),localStorage.setItem("10",'{"time": "300", "usage":0}'),localStorage.setItem("11",'{"time": "600", "usage":0}'),localStorage.setItem("12",'{"time": "1800", "usage":0}'),localStorage.setItem("13",'{"time": "3600", "usage":0}'),localStorage.setItem("restartTime","0")),drawRestartTime(parseInt(localStorage.getItem("restartTime")));for(e=0;e<POP_TIMES_SIZE;e++){var a=JSON.parse(localStorage.getItem(e.toString()));popTimes[e]=a}lastTimer=parseInt(localStorage.getItem("restartTime")),drawPopTimes()}function popTimeDragStart(t){var e=getParentWithClass(t.target,"popTime"),a=JSON.stringify({time:e.getAttribute(POP_TIME_DATA_ATTRIBUTE),index:e.getAttribute(POP_TIME_INDEX)});t.dataTransfer.setData("text/plain",a),dataTransfer=a,isPopTimeDrag=!0}function popTimeMouseOver(t){var e=getParentWithClass(t.target,"popTime");e.setAttribute("class","popTime hover");var a=document.getElementsByClassName("popTime");for(var r in Object.getOwnPropertyNames(a))a[r].isSameNode(e)||a[r].setAttribute("class","popTime highlight")}function popTimeMouseLeave(){var t=document.getElementsByClassName("popTime");for(var e in Object.getOwnPropertyNames(t))t[e].setAttribute("class","popTime start")}function popTimesInit(){var t=document.getElementsByClassName("popTime");for(var e in Object.getOwnPropertyNames(t))t[e].draggable=!0,t[e].addEventListener("click",popTimeClick),t[e].addEventListener("dragstart",popTimeDragStart),t[e].addEventListener("dragend",popTimeDragEnd),t[e].addEventListener("dragover",popTimeDragOver),t[e].addEventListener("dragleave",popTimeDragLeave),t[e].addEventListener("drop",popTimeDrop),t[e].addEventListener("mouseover",popTimeMouseOver),t[e].addEventListener("mouseleave",popTimeMouseLeave)}function restartMouseOver(){var t=document.getElementsByClassName("popTime");for(var e in Object.getOwnPropertyNames(t))t[e].setAttribute("class","popTime highlight")}function restartMouseLeave(){var t=document.getElementsByClassName("popTime");for(var e in Object.getOwnPropertyNames(t))t[e].setAttribute("class","popTime start")}function drawPopTimes(){var t=document.getElementsByClassName("popTime");for(var e in Object.getOwnPropertyNames(popTimes))0!=popTimes[e].time?t[e].innerHTML=fullTimeFormat(popTimes[e].time):t[e].innerHTML="",t[e].setAttribute(POP_TIME_DATA_ATTRIBUTE,popTimes[e].time),t[e].setAttribute(POP_TIME_INDEX,e)}function popTimeClick(t){for(var e=t.target;null===e.getAttribute("class")||!e.getAttribute("class").includes("popTime");)e=e.parentElement;stop(),setViewTime(e.getAttribute(POP_TIME_DATA_ATTRIBUTE)),start()}function onNumClick(t){t.preventDefault()}function pressNum(t){2==document.activeElement.selectionStart&&null!=document.activeElement.next&&(document.activeElement.next.focus(),document.activeElement.setSelectionRange(0,0));var e=document.activeElement,a=e.selectionStart+1;e.value=setCharAt(e.value,e.selectionStart,t-48),a==NUM_SIZE&&null!=document.activeElement.next?(document.activeElement.next.focus(),document.activeElement.setSelectionRange(0,0)):e.setSelectionRange(a,a);var r=document.getElementsByTagName("input");0<(timeToCountInSeconds=parseInt(r[0].value)*secondsInHour+60*parseInt(r[1].value)+parseInt(r[2].value))?document.getElementsByClassName("startStop")[0].setAttribute("class","startStop start"):document.getElementsByClassName("startStop")[0].setAttribute("class","startStop nostart"),drawRestartTime(lastTimer=timeToCountInSeconds)}function setCharAt(t,e,a){return e>t.length-1?t:t.substr(0,e)+a+t.substr(e+1)}function startStop(){ring.paused?null!=tickIntervalId?stop():start():stopRing()}function stopRing(){ring.pause(),ring.currentTime=0;var t=document.getElementsByClassName("startStop")[0];t.setAttribute("class","startStop nostart"),t.children[0].innerText="START"}function start(){var t=document.getElementsByTagName("input");timeToCountInSeconds=parseInt(t[0].value)*secondsInHour+60*parseInt(t[1].value)+parseInt(t[2].value),drawRestartTime(lastTimer=timeToCountInSeconds),0<timeToCountInSeconds&&(document.getElementsByClassName("restart")[0].setAttribute("class","restart start"),startTime=(new Date).getTime(),countedSeconds=0,tickIntervalId=setInterval(onTick,100),toggleStartStop())}function fullTimeFormat(t){var e=formatTime(t);return"<div>"+e.substr(0,2)+'</div><div class="retryTimeUnitLabels">:</div>'+e.substr(2,2)+'</div><div class="retryTimeUnitLabels">:</div>'+e.substr(4,2)}function popTimeOnContextMenu(t){t.preventDefault()}function stop(){null!=tickIntervalId&&toggleStartStop(),clearInterval(tickIntervalId),tickIntervalId=countedSeconds=null}function onTick(){var t=(new Date).getTime();countedSeconds+1<(t-startTime)/1e3&&(countedSeconds++,timeLeft=timeToCountInSeconds-countedSeconds,setViewTime(timeLeft),0==timeLeft&&(stop(),ring.play(),setTimeout(function(){stopRing()},24e3)))}function setViewTime(t){history.pushState(null,"",formatTimeToUrl(t));var e=formatTime(t),a=document.getElementsByTagName("input");a[0].value=e.substr(0,2),a[1].value=e.substr(2,2),a[2].value=e.substr(4,2)}function formatTime(t){var e=Math.floor(t/secondsInHour),a=Math.floor((t-e*secondsInHour)/60),r=Math.floor(t-e*secondsInHour-60*a);return formatNumberLength(e,2).concat(formatNumberLength(a,2),formatNumberLength(r,2))}function formatTimeToUrl(t){var e=Math.floor(t/secondsInHour),a=Math.floor((t-e*secondsInHour)/60),r=Math.floor(t-e*secondsInHour-60*a);return"index.html?"+e.toString()+"hours-"+a.toString()+"minutes-"+r.toString()+"seconds"}function formatNumberLength(t,e){for(var a=""+t;a.length<e;)a="0"+a;return a}function notify(){if("granted"===Notification.permission)new Notification("times up!");else"denied"!==Notification.permission&&Notification.requestPermission(function(t){if("granted"===t)new Notification("times up!")})}function toggleStartStop(){var t=document.getElementsByClassName("popTime"),e=document.getElementsByClassName("time")[0],a=document.getElementsByTagName("input"),r=document.getElementsByClassName("numButton"),s=document.getElementsByClassName("startStop")[0];if("startStop start"==s.getAttribute("class")||"startStop nostart"==s.getAttribute("class")){for(var n in s.setAttribute("class","startStop stop"),s.children[0].innerText=PAUSE_LABEL,Object.getOwnPropertyNames(t))t[n].setAttribute("class","popTime stop");for(var o in a)"INPUT"==a[o].nodeName&&(a[o].disabled=!0);for(var i in r)"DIV"==r[i].nodeName&&r[i].setAttribute("class","numButton stop");e.setAttribute("class","time stop")}else{for(var n in countedSeconds<timeToCountInSeconds?(s.setAttribute("class","startStop start"),s.children[0].innerText="START"):(s.setAttribute("class","startStop stop"),s.children[0].innerText="STOP"),Object.getOwnPropertyNames(t))t[n].setAttribute("class","popTime start");for(var m in a)"INPUT"==a[m].nodeName&&(a[m].disabled=!1);for(var l in r)"DIV"==r[l].nodeName&&r[l].setAttribute("class","numButton start");e.setAttribute("class","time start")}}function restart(){0<lastTimer&&(setViewTime(lastTimer),stop(),start())}function dragTimeMouseDown(t){for(var e=t.target;null===e.getAttribute("class")||!e.getAttribute("class").includes("restart");)e=e.parentElement;var a=document.getElementsByTagName("input");parseInt(a[0].value),parseInt(a[1].value),parseInt(a[2].value)}function drawRestartTime(t){localStorage.setItem("restartTime",t.toString()),document.getElementsByClassName("restartTime")[0].innerHTML=fullTimeFormat(t)}function dragTimeStart(t){var e=JSON.stringify({time:lastTimer,index:0});t.dataTransfer.setData("text/plain",e),dataTransfer=e,t.dataTransfer.dropEffect="copy";for(var a=t.target;null===a.getAttribute("class")||!a.getAttribute("class").includes("restart");)a=a.parentElement}function popTimeDragOver(t){for(var e=t.target;null===e.getAttribute("class")||!e.getAttribute("class").includes("popTime");)e=e.parentElement;e.setAttribute("class","popTime hover"),event.preventDefault()}function popTimeDragLeave(t){for(var e=t.target;null===e.getAttribute("class")||!e.getAttribute("class").includes("popTime");)e=e.parentElement;isPopTimeDrag?e.setAttribute("class","popTime highlight"):e.setAttribute("class","popTime start")}function popTimeDragEnd(t){}function popTimeDrop(t){dataTransfer=null;for(var e=JSON.parse(t.dataTransfer.getData("text/plain")),a=t.target;null===a.getAttribute("class")||!a.getAttribute("class").includes("popTime");)a=a.parentElement;var r=a.getAttribute(POP_TIME_INDEX);localStorage.setItem(r.toString(),'{"time": "'+e.time.toString()+'", "usage":0}'),popTimes[r.toString()]={time:e.time,usage:0},0!=e.index&&(popTimes[e.index.toString()]={time:a.getAttribute(POP_TIME_DATA_ATTRIBUTE),usage:0}),drawPopTimes(),a.setAttribute("class","popTime start"),restartDragRestore()}function dragTimeEnd(){restartDragRestore()}function restartDragRestore(){document.getElementsByClassName("restart")[0].setAttribute("class","restart start")}function getParentWithClass(t,e){for(var a=t;null===a.getAttribute("class")||!a.getAttribute("class").includes(e);)a=a.parentElement;return a}window.onkeydown=function(t){"INPUT"!=document.activeElement.nodeName&&document.getElementsByTagName("input")[0].focus(),48<=t.keyCode&&t.keyCode<=57&&pressNum(t.keyCode)},window.onclick=function(t){ring.paused||stopRing()};